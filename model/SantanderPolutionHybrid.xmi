<?xml version="1.0" encoding="UTF-8"?>
<pasys:ComputationalSystem
    xmi:version="2.0"
    xmlns:xmi="http://www.omg.org/XMI"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:pasys="www.unican.es/ISTR/P3forI4/pasys"
    xsi:schemaLocation="www.unican.es/ISTR/P3forI4/pasys ../metamodels/PABM_Metamodel.ecore#//pasys"
    name="SantanderPollution"
    date="20/11/2019"
    authors="P. López y R. Dintén">
  <ownedElements
      xsi:type="pasys:PhysicalProcessingNode"
      name="NimbusNode"
      id="NimbusNode"
      concurrencyLevel="8"
      ip="172.31.16.48"
      userName="gestor"
      os="Ubuntu"/>
  <ownedElements
      xsi:type="pasys:PhysicalProcessingNode"
      name="CassandraNode"
      id="CassandraNode"
      ip="172.31.16.51"
      userName="gestor"
      os="Ubuntu"/>
  <ownedElements
      xsi:type="pasys:PhysicalProcessingNode"
      name="KafkaNode"
      id="KafkaNode"
      ip="172.31.16.47"
      userName="gestor"
      os="Ubuntu"/>
  <ownedElements
      xsi:type="pasys:PhysicalProcessingNode"
      name="SupervisorNode"
      id="SupervisorNode"
      ip="172.31.16.52"
      userName="gestor"
      os="Ubuntu"/>
  <ownedElements
      xsi:type="pasys:PhysicalProcessingNode"
      name="ZkNode"
      id="ZkNode"
      ip="172.31.16.49"
      userName="gestor"
      os="Ubuntu"/>
  <ownedElements
      xsi:type="pasys:NodeCluster"
      name="PollutionCluster"
      id="PollutionCluster"
      resources="//@ownedElements.3"/>
  <ownedElements
      xsi:type="pasys:NodeCluster"
      name="NimbusCluster"
      id="NimbusCluster"
      resources="//@ownedElements.0"/>
  <ownedElements
      xsi:type="pasys:NodeCluster"
      name="SupervisorCluster"
      id="SupervisorCluster"
      resources="//@ownedElements.3"/>
  <ownedElements
      xsi:type="pasys:ZookeeperServer"
      name="PollutionZookeeper"
      id="2"
      artifactName="zkServer.sh"
      artifactLocator="/home/gestor/apache/servers/zookeeper/bin"
      scriptFolderPath="/home/gestor/apache/servers/zookeeper/scripts"
      configFolderPath="/home/gestor/apache/servers/zookeeper/conf"
      dataFolderPath="/home/gestor/apache/servers/zookeeper/dataDir"
      logFolderPath="/home/gestor/apache/servers/zookeeper/logs"
      host="//@ownedElements.4"
      target="//@ownedElements.9"
      serverId="2"/>
  <ownedElements
      xsi:type="pasys:ResourceCluster"
      name="PollutionZkCluster"
      id="PollutionZkCluster"
      resources="2"/>
  <ownedElements
      xsi:type="pasys:KafkaServer"
      name="PollutionKafka"
      id="1"
      artifactName="kafka-server-start.sh"
      artifactLocator="/home/gestor/apache/servers/kafka/bin"
      scriptFolderPath="/home/gestor/apache/servers/kafka/scripts"
      configFolderPath="/home/gestor/apache/servers/kafka/config"
      dataFolderPath="/home/gestor/apache/servers/kafka/data"
      logFolderPath="/home/gestor/apache/servers/kafka/logs"
      host="//@ownedElements.2"
      target="//@ownedElements.5"
      commId="1"
      autoCreateTopicEnable="true"
      zookeeperConnect="//@ownedElements.9"
      listeners="PLAINTEXT://172.31.16.47:9092"
      advertisedListeners="PLAINTEXT://172.31.16.47:9092"
      clientPort="9092"/>
  <ownedElements
      xsi:type="pasys:CassandraServer"
      name="PollutionCassandra"
      id="3"
      artifactName="cassandra"
      artifactLocator="/home/gestor/apache/servers/cassandra/bin"
      scriptFolderPath="/home/gestor/apache/servers/cassandra/scripts"
      configFolderPath="/home/gestor/apache/servers/cassandra/conf"
      dataFolderPath="/home/gestor/apache/servers/cassandra/data/data"
      logFolderPath="/home/gestor/apache/servers/cassandra/commitlog"
      target="//@ownedElements.12"
      container="//@ownedElements.28"
      logging="root"
      passwd="root"
      seeds="//@ownedElements.12"
      seedProviderClass="SimpleSeedProvider"
      listenAddress="//@ownedElements.20"
      rpcAddress="//@ownedElements.20"
      endpointSnitch="GossipingPropertyFileSnitch"
      dataCenter="//@ownedElements.12"
      dataFileDir="/home/gestor/apache/servers/cassandra/data/data"
      rack="//@ownedElements.12"
      isSeed="true">
    <cqlSchemas
        filePath="/home/gestor/herramientaDespliegue/workspaceEclipse/PASYSDeploymentToolGlobal"
        fileName="cassandra_schema.sql"/>
  </ownedElements>
  <ownedElements
      xsi:type="pasys:ResourceCluster"
      name="CassandraCluster"
      id="CassandraCluster"
      resources="//@ownedElements.11"/>
  <ownedElements
      xsi:type="pasys:StormServer"
      name="PollutionStormNimbus"
      id="4"
      artifactName="storm"
      artifactLocator="/home/gestor/apache/servers/storm/bin"
      scriptFolderPath="/home/gestor/apache/servers/storm/scripts"
      configFolderPath="/home/gestor/apache/servers/storm/conf"
      dataFolderPath="/home/gestor/apache/servers/storm/data"
      logFolderPath="/home/gestor/apache/servers/storm/logs"
      target="//@ownedElements.6"
      container="//@ownedElements.26"
      workflows="//@ownedElements.16"
      zookeeperConnect="//@ownedElements.9"
      nimbusSeeds="//@ownedElements.6"
      supervisors="//@ownedElements.7"
      isNimbus="true">
    <supervisorSlotPorts>6700</supervisorSlotPorts>
    <supervisorSlotPorts>6701</supervisorSlotPorts>
    <supervisorSlotPorts>6702</supervisorSlotPorts>
    <supervisorSlotPorts>6703</supervisorSlotPorts>
  </ownedElements>
  <ownedElements
      xsi:type="pasys:StormServer"
      name="PollutionStormSupervisor"
      id="12"
      artifactName="storm"
      artifactLocator="/home/gestor/apache/servers/storm/bin"
      scriptFolderPath="/home/gestor/apache/servers/storm/scripts"
      configFolderPath="/home/gestor/apache/servers/storm/conf"
      dataFolderPath="/home/gestor/apache/servers/storm/data"
      logFolderPath="/home/gestor/apache/servers/storm/logs"
      target="//@ownedElements.7"
      container="//@ownedElements.27"
      zookeeperConnect="//@ownedElements.9"
      nimbusSeeds="//@ownedElements.6">
    <supervisorSlotPorts>6700</supervisorSlotPorts>
    <supervisorSlotPorts>6701</supervisorSlotPorts>
    <supervisorSlotPorts>6702</supervisorSlotPorts>
    <supervisorSlotPorts>6703</supervisorSlotPorts>
  </ownedElements>
  <ownedElements
      xsi:type="pasys:KafkaWorkloadStreamData"
      name="Pollution"
      id="Pollution"
      artifactName="kafka-topics.sh"
      artifactLocator="/home/gestor/apache/servers/kafka/bin"
      scriptFolderPath="/home/gestor/apache/apps/pollution/topics/scripts"
      configFolderPath="/home/gestor/apache/apps/pollution/topics/config"
      dataFolderPath="/home/gestor/apache/apps/pollution/topics/data"
      logFolderPath="/home/gestor/apache/apps/pollution/topics/log"
      numPartitions="1"
      numReplication="1"
      holder="1"/>
  <ownedElements
      xsi:type="pasys:Workflow"
      name="PollutionProcess"
      id="PollutionProcess"
      artifactName="SantanderPollution.jar"
      artifactLocator="/home/gestor/herramientaDespliegue/workspaceEclipse/PASYSDeploymentToolGlobal"
      scriptFolderPath="/home/gestor/apache/apps/pollution/workflows/scripts"
      configFolderPath="/home/gestor/apache/apps/pollution/workflows/config"
      dataFolderPath="/home/gestor/apache/apps/pollution/workflows/data"
      logFolderPath="/home/gestor/apache/apps/pollution/workflows/log"
      rootTask="//@ownedElements.16/@ownedTasks.0"
      scheduler="//@ownedElements.13">
    <arguments>172.31.16.47</arguments>
    <arguments>172.31.16.51</arguments>
    <ownedTasks
        name="MainTask"
        id="MainTask"
        implementingClassName="es.unican.dintenr.santanderPollution.SantanderPollutionTopology"
        triggerStreamData="//@ownedElements.15"
        inputStreamData="//@ownedElements.15"/>
  </ownedElements>
  <ownedElements
      xsi:type="pasys:AWSVirtualProcessingNode"
      name="SwarmManagerVNode"
      id="SwarmManagerVNode"
      memorySize="2048"
      ip="172.31.21.96"
      userName="gestor"
      externalIP="34.255.137.20"
      vpc="default"
      subNet="eu-west-a"
      keyPair=""
      securityGroup="IAP_SecurityGroup"
      AMI="IAP4.0_AMI"
      instanceType="t2.small"/>
  <ownedElements
      xsi:type="pasys:AWSVirtualProcessingNode"
      name="NimbusSwarmWorkerVNode"
      id="NimbusSwarmWorkerVNode"
      memorySize="2048"
      ip="172.31.25.72"
      userName="gestor"
      externalIP="54.194.37.254"
      vpc="default"
      subNet="eu-west-a"
      keyPair="ISTR_keypair.pem"
      securityGroup="IAP_Security_Group"
      AMI="IAP4.0_AMI"
      instanceType="t2.small"/>
  <ownedElements
      xsi:type="pasys:AWSVirtualProcessingNode"
      name="SupervisorSwarmWorkerVNode"
      id="SupervisorSwarmWorkerVNode"
      memorySize="2048"
      ip="172.31.26.169"
      userName="gestor"
      externalIP="34.248.160.67"
      vpc="default"
      subNet="eu-west-a"
      keyPair="ISTR_keypair.pem"
      securityGroup="IAP_Security_Group"
      AMI="IAP4.0_AMI"
      instanceType="t2.small"/>
  <ownedElements
      xsi:type="pasys:AWSVirtualProcessingNode"
      name="CassandraSwarmWorkerVNode"
      id="CassandraSwarmWorkerVNode"
      memorySize="2048"
      ip="172.31.25.7"
      userName="gestor"
      externalIP="54.194.247.222"
      vpc="default"
      subNet="eu-west-a"
      keyPair="ISTR_keypair.pem"
      securityGroup="ISTR_Security_Group"
      AMI="IAP4.0_AMI"
      instanceType="t2.small"/>
  <ownedElements
      xsi:type="pasys:DockerServer"
      name="SwarmManagerDockerServer"
      id="SwarmManagerDockerServer"
      scriptFolderPath="/home/gestor/apache/servers/docker/scripts"
      configFolderPath="/home/gestor/apache/servers/docker/conf"
      dataFolderPath=""
      host="//@ownedElements.17"
      swarmCluster="//@ownedElements.25">
    <stacks
        name="PollutionStack"
        id="PollutionStack"
        swarmCluster="//@ownedElements.25">
      <services
          name="nimbus"
          id="nimbus"
          image="//@ownedElements.29/@repositories.0/@images.0"
          command="storm nimbus">
        <volumes
            source="/home/gestor/apache/servers/storm/conf"
            target="/conf"
            type="BIND"/>
        <volumes
            source="/home/gestor/apache/servers/storm/logs"
            target="/logs"
            type="BIND"/>
        <volumes
            source="/home/gestor/apache/servers/storm/scripts"
            target="/scripts"/>
        <ports
            target="6627"
            published="6627"
            mode="INGRESS"/>
        <ports
            target="3772"
            published="3772"
            mode="INGRESS"/>
        <ports
            target="3773"
            published="3773"
            mode="INGRESS"/>
        <ports
            target="3774"
            published="3774"
            mode="INGRESS"/>
        <networks
            ipv4Address="storm"
            network="//@ownedElements.21/@stacks.0/@networks.0"/>
        <deploymentParam
            replicas="1">
          <placement
              key="node.labels.nimbus"
              value="1"/>
          <restartPolicy
              key="condition"
              value="on-failure"/>
          <restartPolicy
              key="delay"
              value="5s"/>
          <restartPolicy
              key="max_attempts"
              value="3"/>
          <restartPolicy
              key="window"
              value="120s"/>
        </deploymentParam>
      </services>
      <services
          name="cassandra"
          image="//@ownedElements.29/@repositories.0/@images.1">
        <env
            key="CASSANDRA_BROADCAST_ADDRESS"
            value="cassandra"/>
        <env
            key="CASSANDRA_CLUSTER_NAME"
            value="POLLUTION_CLUSTER"/>
        <env
            key="CASSANDRA_ENDPOINT_SNITCH"
            value="GossipingPropertyFileSnitch"/>
        <env
            key="CASSANDRA_DC"
            value="dc1"/>
        <env
            key="CASSANDRA_RACK"
            value="rack1"/>
        <env
            key="CASSANDRA_SEEDS"
            value="cassandra"/>
        <volumes
            source="/home/gestor/apache/cassandra/conf"
            target="/home/gestor/apache/cassandra/conf"
            type="BIND"/>
        <volumes
            source="/home/gestor/apache/cassandra/logs"
            target="/var/log/cassandra"/>
        <ports
            target="9042"
            published="9042"
            mode="INGRESS"/>
        <networks
            ipv4Address="storm"
            network="//@ownedElements.21/@stacks.0/@networks.0">
          <aliases>cassandra</aliases>
        </networks>
        <deploymentParam
            replicas="1">
          <placement
              key="node.labels.cassandra"
              value="1"/>
        </deploymentParam>
      </services>
      <services
          name="supervisor"
          id="supervisor"
          dependsOn="//@ownedElements.21/@stacks.0/@services.0"
          image="//@ownedElements.29/@repositories.0/@images.0">
        <volumes
            source="/home/gestor/apache/servers/storm/conf/storm.yaml"
            target="/conf/storm.yaml"
            type="BIND"/>
        <volumes
            source="/home/gestor/apache/servers/storm/logs"
            target="/logs"
            type="BIND"/>
        <ports
            target="6700"
            published="6700"
            mode="INGRESS"/>
        <ports
            target="6701"
            published="6701"
            mode="INGRESS"/>
        <ports
            target="6702"
            published="6702"
            mode="INGRESS"/>
        <ports
            target="6703"
            published="6703"
            mode="INGRESS"/>
        <networks
            ipv4Address="storm"
            network="//@ownedElements.21/@stacks.0/@networks.0"/>
        <deploymentParam
            replicas="1">
          <placement
              key="node.labels.supervisor"
              value="1"/>
        </deploymentParam>
      </services>
      <networks
          name="network"
          id="network"
          driver="OVERLAY"/>
    </stacks>
  </ownedElements>
  <ownedElements
      xsi:type="pasys:DockerServer"
      name="NimbusWorkerDockerServer"
      id="NimbusWorkerDockerServer"
      host="//@ownedElements.18"
      swarmCluster="//@ownedElements.25"/>
  <ownedElements
      xsi:type="pasys:DockerServer"
      name="SupervisorWorkerDockerServer"
      id="SupervisorWorkerDockerServer"
      host="//@ownedElements.19"
      swarmCluster="//@ownedElements.25"/>
  <ownedElements
      xsi:type="pasys:DockerServer"
      name="CassandraWorkerDockerServer"
      id="CassandraWorkerDockerServer"
      host="//@ownedElements.20"
      swarmCluster="//@ownedElements.25"/>
  <ownedElements
      xsi:type="pasys:SwarmCluster"
      name="SantanderPollutionSwarmCluster"
      id="SantanderPollutionSwarmCluster"
      workers="//@ownedElements.22 //@ownedElements.23 //@ownedElements.24"
      manager="//@ownedElements.21"/>
  <ownedElements
      xsi:type="pasys:DockerContainer"
      name="NimbusDockerContainer"
      id="NimbusDockerContainer"
      host="//@ownedElements.22"
      service="//@ownedElements.21/@stacks.0/@services.0"/>
  <ownedElements
      xsi:type="pasys:DockerContainer"
      name="SupervisorDockerContainer"
      id="SupervisorDockerContainer"
      host="//@ownedElements.23"/>
  <ownedElements
      xsi:type="pasys:DockerContainer"
      name="CassandraDockerContainer"
      id="CassandraDockerContainer"
      host="//@ownedElements.24"
      service="//@ownedElements.21/@stacks.0/@services.1"/>
  <ownedElements
      xsi:type="pasys:Registry"
      name="reg"
      id="reg"
      url="www.unican.es/istr">
    <repositories
        name="repo"
        id="repo">
      <images
          name="storm"
          id="stormImg"
          repository="//@ownedElements.29/@repositories.0"
          tag="latest"/>
      <images
          name="cassandra"
          id="csdrImg"
          repository="//@ownedElements.29/@repositories.0"/>
    </repositories>
  </ownedElements>
</pasys:ComputationalSystem>
